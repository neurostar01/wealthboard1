<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WealthBoard â€” ìì‚°ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{--b9:#0d1b3e;--b6:#1d4ed8;--b5:#3b82f6;--b4:#60a5fa;--b3:#93c5fd;--b0:#eff6ff;--g0:#f8fafc;--g1:#f1f5f9;--g2:#e2e8f0;--g4:#94a3b8;--g6:#475569;--g8:#1e293b;--gn:#10b981;--rd:#ef4444;--og:#f59e0b;--pu:#8b5cf6;--sh:0 1px 3px rgba(13,27,62,.08);--shm:0 4px 16px rgba(13,27,62,.12);--shl:0 12px 40px rgba(13,27,62,.18);--r:16px;--rs:10px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',-apple-system,sans-serif;background:var(--g0);color:var(--g8);min-height:100vh}
.sidebar{position:fixed;left:0;top:0;width:240px;height:100vh;background:var(--b9);display:flex;flex-direction:column;z-index:100;box-shadow:4px 0 24px rgba(13,27,62,.18)}
.sidebar-logo{padding:28px 24px 22px;border-bottom:1px solid rgba(255,255,255,.08)}
.logo-mark{display:flex;align-items:center;gap:10px}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--b5),var(--b4));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
.logo-text{font-size:17px;font-weight:700;color:#fff;letter-spacing:-.3px}
.logo-sub{font-size:11px;color:var(--b3);margin-top:2px}
.sidebar-nav{padding:16px 12px;flex:1}
.nav-label{font-size:10px;font-weight:600;color:var(--b4);letter-spacing:1.2px;text-transform:uppercase;padding:0 12px;margin:16px 0 6px}
.nav-item{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:var(--rs);color:rgba(255,255,255,.6);font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;margin-bottom:2px}
.nav-item:hover{background:rgba(255,255,255,.06);color:#fff}
.nav-item.active{background:rgba(59,130,246,.2);color:#fff}
.nav-icon{font-size:16px;width:20px;text-align:center}
.sidebar-footer{padding:14px 12px;border-top:1px solid rgba(255,255,255,.08)}
.user-card{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--rs);background:rgba(255,255,255,.06)}
.user-avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--b5),var(--pu));display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;font-weight:600}
.user-name{font-size:13px;font-weight:600;color:#fff}
.user-plan{font-size:11px;color:var(--b3)}
.main{margin-left:240px;min-height:100vh}
.topbar{background:#fff;border-bottom:1px solid var(--g2);padding:0 32px;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.page-title{font-size:20px;font-weight:700;letter-spacing:-.5px}
.page-sub{font-size:12px;color:var(--g4);margin-top:1px}
.topbar-right{display:flex;align-items:center;gap:10px}
.btn-icon{width:38px;height:38px;border-radius:10px;background:var(--g1);border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:background .2s}
.btn-icon:hover{background:var(--g2)}
.btn-primary{background:var(--b6);color:#fff;border:none;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;transition:background .2s;font-family:inherit;display:flex;align-items:center;gap:6px}
.btn-primary:hover{background:#1e40af}
.date-badge{font-size:12px;color:var(--g4);background:var(--g1);padding:6px 12px;border-radius:8px;font-family:'DM Mono',monospace}
.api-bar{background:#fff;border-bottom:1px solid var(--g1);padding:7px 32px;display:flex;align-items:center;gap:18px;flex-wrap:wrap}
.api-label{font-size:10px;font-weight:600;color:var(--g4);letter-spacing:.8px;text-transform:uppercase}
.api-badge{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--g6)}
.api-dot{width:7px;height:7px;border-radius:50%;background:var(--g2);flex-shrink:0}
.api-dot.ok{background:var(--gn)}
.api-dot.loading{background:var(--og);animation:blink 1s infinite}
.api-dot.error{background:var(--rd)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.api-updated{margin-left:auto;font-size:11px;color:var(--g4);font-family:'DM Mono',monospace}
.content{padding:28px 32px}
.summary-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.summary-card{background:#fff;border-radius:var(--r);padding:22px;box-shadow:var(--sh);border:1px solid var(--g2);position:relative;overflow:hidden;transition:box-shadow .2s,transform .2s;animation:fadeUp .4s ease both}
.summary-card:hover{box-shadow:var(--shm);transform:translateY(-2px)}
.summary-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.summary-card.total::before{background:linear-gradient(90deg,var(--b6),var(--b4))}
.summary-card.domestic::before{background:linear-gradient(90deg,#10b981,#34d399)}
.summary-card.overseas::before{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
.summary-card.crypto::before{background:linear-gradient(90deg,#8b5cf6,#a78bfa)}
.summary-card:nth-child(1){animation-delay:.05s}
.summary-card:nth-child(2){animation-delay:.10s}
.summary-card:nth-child(3){animation-delay:.15s}
.summary-card:nth-child(4){animation-delay:.20s}
.card-label{font-size:12px;font-weight:500;color:var(--g4);margin-bottom:10px}
.card-value{font-size:21px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:-.5px;margin-bottom:8px}
.card-change{font-size:12px;font-weight:600}
.card-change.up{color:var(--gn)}
.card-change.down{color:var(--rd)}
.card-icon{position:absolute;right:18px;top:18px;font-size:28px;opacity:.1}
.main-grid{display:grid;grid-template-columns:1fr 340px;gap:20px;margin-bottom:20px}
.card{background:#fff;border-radius:var(--r);box-shadow:var(--sh);border:1px solid var(--g2);overflow:hidden}
.card-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 16px;border-bottom:1px solid var(--g1)}
.card-title{font-size:15px;font-weight:700}
.card-body{padding:20px 24px}
.chart-wrap{height:220px;position:relative}
.chart-tabs{display:flex;gap:4px}
.chart-tab{padding:5px 12px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--g4);transition:all .2s;font-family:inherit}
.chart-tab.active{background:var(--b0);color:var(--b6)}
.pie-wrap{height:180px;margin-bottom:16px}
.legend-list{display:flex;flex-direction:column;gap:8px}
.legend-item{display:flex;align-items:center;justify-content:space-between}
.legend-left{display:flex;align-items:center;gap:8px}
.legend-dot{width:10px;height:10px;border-radius:3px}
.legend-name{font-size:13px;color:var(--g6)}
.legend-pct{font-size:13px;font-weight:600;font-family:'DM Mono',monospace}
.portfolio-card{background:#fff;border-radius:var(--r);box-shadow:var(--sh);border:1px solid var(--g2);overflow:hidden;margin-bottom:20px}
.portfolio-table{width:100%;border-collapse:collapse}
.portfolio-table th{font-size:11px;font-weight:600;color:var(--g4);letter-spacing:.5px;text-align:left;padding:14px 20px 12px;text-transform:uppercase;background:var(--g0);border-bottom:1px solid var(--g2)}
.portfolio-table th:not(:first-child){text-align:right}
.portfolio-table td{padding:13px 20px;border-bottom:1px solid var(--g1);font-size:13px;vertical-align:middle}
.portfolio-table tbody tr:last-child td{border-bottom:none}
.portfolio-table td:not(:first-child){text-align:right}
.portfolio-table tbody tr{transition:background .15s}
.portfolio-table tbody tr:hover{background:var(--g0)}
.stock-info{display:flex;align-items:center;gap:10px}
.stock-badge{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff;flex-shrink:0}
.stock-name{font-size:13px;font-weight:600}
.stock-ticker{font-size:11px;color:var(--g4);font-family:'DM Mono',monospace;margin-top:1px}
.badge-type{display:inline-block;padding:3px 9px;border-radius:6px;font-size:10px;font-weight:600}
.badge-kr{background:#dbeafe;color:var(--b6)}
.badge-us{background:#fef3c7;color:#d97706}
.badge-crypto{background:#ede9fe;color:#7c3aed}
.text-mono{font-family:'DM Mono',monospace;font-size:13px}
.text-up{color:var(--gn);font-weight:600}
.text-down{color:var(--rd);font-weight:600}
.row-actions{display:flex;justify-content:flex-end;gap:6px;opacity:0;transition:opacity .15s}
.portfolio-table tbody tr:hover .row-actions{opacity:1}
.btn-row{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .15s}
.btn-edit{background:var(--b0);color:var(--b6)}
.btn-edit:hover{background:#dbeafe}
.btn-del{background:#fee2e2;color:var(--rd)}
.btn-del:hover{background:#fecaca}
.price-loading{color:var(--og);font-size:11px}
.price-live{color:var(--gn);font-size:10px;margin-left:4px}
.empty-state{text-align:center;padding:48px 20px;color:var(--g4)}
.empty-icon{font-size:40px;margin-bottom:12px}
.empty-title{font-size:15px;font-weight:600;color:var(--g6);margin-bottom:6px}
.empty-sub{font-size:13px}
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.tx-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--g1)}
.tx-item:last-child{border-bottom:none}
.tx-left{display:flex;align-items:center;gap:12px}
.tx-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px}
.tx-icon.buy{background:#dbeafe}
.tx-icon.sell{background:#fee2e2}
.tx-icon.deposit{background:#d1fae5}
.tx-name{font-size:13px;font-weight:600}
.tx-date{font-size:11px;color:var(--g4);margin-top:1px}
.tx-price{font-size:13px;font-weight:700;font-family:'DM Mono',monospace;text-align:right}
.tx-qty{font-size:11px;color:var(--g4);margin-top:1px;text-align:right}
.tag{display:inline-block;padding:3px 9px;border-radius:6px;font-size:11px;font-weight:600}
.tag-up{background:#d1fae5;color:#059669}
.tag-down{background:#fee2e2;color:#dc2626}

/* â”€â”€ ì¢…ëª© ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(13,27,62,.45);backdrop-filter:blur(4px);z-index:200;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:#fff;border-radius:20px;width:520px;max-width:95vw;box-shadow:var(--shl);transform:translateY(20px) scale(.97);transition:transform .25s;overflow:hidden}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal-header{padding:24px 28px 18px;border-bottom:1px solid var(--g1);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-size:17px;font-weight:700}
.modal-close{width:32px;height:32px;border-radius:8px;border:none;background:var(--g1);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:background .15s}
.modal-close:hover{background:var(--g2)}
.modal-body{padding:22px 28px}
.modal-footer{padding:14px 28px 22px;display:flex;gap:10px;justify-content:flex-end;border-top:1px solid var(--g1)}
.form-group{margin-bottom:16px}
.form-label{font-size:12px;font-weight:600;color:var(--g6);letter-spacing:.3px;margin-bottom:6px;display:flex;align-items:center;gap:6px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.form-input{width:100%;padding:10px 14px;border:1.5px solid var(--g2);border-radius:10px;font-size:14px;font-family:inherit;color:var(--g8);outline:none;transition:border-color .2s,box-shadow .2s}
.form-input:focus{border-color:var(--b5);box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.form-input:disabled{background:var(--g0);color:var(--g4)}
.form-select{width:100%;padding:10px 14px;border:1.5px solid var(--g2);border-radius:10px;font-size:14px;font-family:inherit;color:var(--g8);outline:none;appearance:none;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%2394a3b8' d='M5 7L0 2h10z'/%3E%3C/svg%3E") no-repeat right 14px center;background-color:#fff;cursor:pointer;transition:border-color .2s}
.form-select:focus{border-color:var(--b5);outline:none}
.price-auto-row{display:flex;align-items:center;gap:8px}
.btn-fetch-price{padding:8px 14px;border-radius:8px;background:var(--b0);color:var(--b6);border:none;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;white-space:nowrap;transition:background .15s;display:flex;align-items:center;gap:5px}
.btn-fetch-price:hover{background:#dbeafe}
.btn-fetch-price:disabled{opacity:.5;cursor:not-allowed}
.fetch-status{font-size:11px;color:var(--g4)}
.fetch-status.ok{color:var(--gn)}
.fetch-status.err{color:var(--rd)}
.color-swatches{display:flex;gap:7px;flex-wrap:wrap;margin-top:8px}
.swatch{width:28px;height:28px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:all .15s}
.swatch:hover{transform:scale(1.15)}
.swatch.selected{border-color:var(--g8);transform:scale(1.1)}
.btn-secondary{background:var(--g1);color:var(--g6);border:none;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:background .2s}
.btn-secondary:hover{background:var(--g2)}
.btn-danger{background:#fee2e2;color:var(--rd);border:none;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:background .2s}
.btn-danger:hover{background:#fecaca}
.hint-box{background:var(--g0);border:1px solid var(--g2);border-radius:10px;padding:12px 14px;font-size:12px;color:var(--g6);line-height:1.6;margin-top:4px}
.hint-box strong{color:var(--g8)}

/* â”€â”€ ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (ëª¨ë‹¬ë³´ë‹¤ ë†’ì€ z-index) â”€â”€ */
.confirm-overlay{position:fixed;inset:0;background:rgba(13,27,62,.55);backdrop-filter:blur(6px);z-index:500;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s}
.confirm-overlay.open{opacity:1;pointer-events:all}
.confirm-box{background:#fff;border-radius:18px;padding:32px 28px;width:340px;max-width:90vw;box-shadow:0 20px 60px rgba(13,27,62,.25);transform:scale(.95) translateY(8px);transition:transform .2s;text-align:center}
.confirm-overlay.open .confirm-box{transform:scale(1) translateY(0)}
.confirm-icon{font-size:38px;margin-bottom:14px}
.confirm-msg{font-size:16px;font-weight:700;color:var(--g8);margin-bottom:6px;line-height:1.4}
.confirm-sub{font-size:13px;color:var(--g4);margin-bottom:24px}
.confirm-btns{display:flex;gap:10px;justify-content:center}

/* Toast */
.toast{position:fixed;bottom:32px;right:32px;background:var(--g8);color:#fff;padding:12px 20px;border-radius:12px;font-size:13px;font-weight:500;z-index:600;transform:translateY(20px);opacity:0;transition:all .3s;pointer-events:none;display:flex;align-items:center;gap:8px;box-shadow:var(--shl)}
.toast.show{transform:translateY(0);opacity:1}

@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<nav class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-mark">
      <div class="logo-icon">ğŸ“ˆ</div>
      <div><div class="logo-text">WealthBoard</div><div class="logo-sub">ìì‚°ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</div></div>
    </div>
  </div>
  <div class="sidebar-nav">
    <div class="nav-label">ë©”ì¸</div>
    <div class="nav-item active"><span class="nav-icon">ğŸ </span> ëŒ€ì‹œë³´ë“œ</div>
    <div class="nav-item"><span class="nav-icon">ğŸ’¼</span> í¬íŠ¸í´ë¦¬ì˜¤</div>
    <div class="nav-item"><span class="nav-icon">ğŸ“Š</span> ìˆ˜ìµ ë¶„ì„</div>
    <div class="nav-label">ê´€ë¦¬</div>
    <div class="nav-item" onclick="openModal()"><span class="nav-icon">â•</span> ì¢…ëª© ì¶”ê°€</div>
    <div class="nav-item"><span class="nav-icon">ğŸ”„</span> ê±°ë˜ ë‚´ì—­</div>
    <div class="nav-label">ì„¤ì •</div>
    <div class="nav-item"><span class="nav-icon">âš™ï¸</span> í™˜ê²½ì„¤ì •</div>
  </div>
  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar">ê¹€</div>
      <div><div class="user-name">ê¹€íˆ¬ì</div><div class="user-plan" id="user-mode">ì—°ê²° ì¤‘...</div></div>
    </div>
  </div>
</nav>

<div class="main">
  <header class="topbar">
    <div>
      <div class="page-title">ëŒ€ì‹œë³´ë“œ</div>
      <div class="page-sub">í¬íŠ¸í´ë¦¬ì˜¤ ì¢…í•© í˜„í™©</div>
    </div>
    <div class="topbar-right">
      <div class="date-badge" id="current-date">â€”</div>
      <button class="btn-icon" onclick="fetchLive()" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
      <button class="btn-primary" onclick="openModal()">ï¼‹ ì¢…ëª© ì¶”ê°€</button>
    </div>
  </header>

  <div class="api-bar">
    <span class="api-label">ë°ì´í„° ì—°ë™</span>
    <div class="api-badge"><div class="api-dot loading" id="dot-gist"></div> <span id="lbl-gist">Gist ì—°ê²° ì¤‘...</span></div>
    <div class="api-badge"><div class="api-dot loading" id="dot-crypto"></div> ì•”í˜¸í™”í (CoinGecko)</div>
    <div class="api-badge"><div class="api-dot loading" id="dot-kr"></div> êµ­ë‚´ì£¼ì‹ (Yahoo Finance)</div>
    <div class="api-badge"><div class="api-dot loading" id="dot-us"></div> í•´ì™¸ì£¼ì‹ (StockPrices)</div>
    <div class="api-badge"><div class="api-dot loading" id="dot-fx"></div> í™˜ìœ¨ (ì‹¤ì‹œê°„)</div>
    <span class="api-updated" id="api-updated">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
  </div>

  <div class="content">
    <div class="summary-grid">
      <div class="summary-card total"><div class="card-icon">ğŸ’°</div><div class="card-label">ì´ ìì‚°</div><div class="card-value" id="s-total">â€”</div><div class="card-change" id="s-total-c">â€”</div></div>
      <div class="summary-card domestic"><div class="card-icon">ğŸ‡°ğŸ‡·</div><div class="card-label">êµ­ë‚´ ì£¼ì‹</div><div class="card-value" id="s-kr">â€”</div><div class="card-change" id="s-kr-c">â€”</div></div>
      <div class="summary-card overseas"><div class="card-icon">ğŸŒ</div><div class="card-label">í•´ì™¸ ì£¼ì‹</div><div class="card-value" id="s-us">â€”</div><div class="card-change" id="s-us-c">â€”</div></div>
      <div class="summary-card crypto"><div class="card-icon">â‚¿</div><div class="card-label">ì•”í˜¸í™”í (ì‹¤ì‹œê°„)</div><div class="card-value" id="s-crypto">â€”</div><div class="card-change" id="s-crypto-c">â€”</div></div>
    </div>

    <div class="main-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“ˆ ìˆ˜ìµë¥  ì¶”ì´</div>
          <div class="chart-tabs">
            <button class="chart-tab" onclick="switchTab(this,'1W')">1ì£¼</button>
            <button class="chart-tab active" onclick="switchTab(this,'1M')">1ê°œì›”</button>
            <button class="chart-tab" onclick="switchTab(this,'3M')">3ê°œì›”</button>
            <button class="chart-tab" onclick="switchTab(this,'1Y')">1ë…„</button>
          </div>
        </div>
        <div class="card-body"><div class="chart-wrap"><canvas id="returnChart"></canvas></div></div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">ğŸ¥§ ìì‚° ë¹„ì¤‘</div></div>
        <div class="card-body">
          <div class="pie-wrap"><canvas id="pieChart"></canvas></div>
          <div class="legend-list">
            <div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#3b82f6"></div><span class="legend-name">êµ­ë‚´ ì£¼ì‹</span></div><span class="legend-pct" id="pct-kr">â€”</span></div>
            <div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#f59e0b"></div><span class="legend-name">í•´ì™¸ ì£¼ì‹</span></div><span class="legend-pct" id="pct-us">â€”</span></div>
            <div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#8b5cf6"></div><span class="legend-name">ì•”í˜¸í™”í</span></div><span class="legend-pct" id="pct-crypto">â€”</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ë³´ìœ  ì¢…ëª© -->
    <div class="portfolio-card">
      <div style="padding:20px 24px 16px;border-bottom:1px solid var(--g1);display:flex;align-items:center;justify-content:space-between">
        <div>
          <div style="font-size:15px;font-weight:700">ğŸ’¼ ë³´ìœ  ì¢…ëª©</div>
          <div style="font-size:12px;color:var(--g4);margin-top:2px" id="portfolio-count">0ì¢…ëª©</div>
        </div>
        <button class="btn-primary" onclick="openModal()" style="font-size:12px;padding:8px 16px">ï¼‹ ì¢…ëª© ì¶”ê°€</button>
      </div>
      <table class="portfolio-table">
        <thead>
          <tr>
            <th>ì¢…ëª©</th><th>ìœ í˜•</th><th>í˜„ì¬ê°€</th><th>ë³´ìœ ìˆ˜ëŸ‰</th>
            <th>í‰ê· ë§¤ìˆ˜ê°€</th><th>í‰ê°€ê¸ˆì•¡</th><th>ìˆ˜ìµë¥ </th><th></th>
          </tr>
        </thead>
        <tbody id="portfolio-body"></tbody>
      </table>
    </div>

    <div class="bottom-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸª™ ì‹¤ì‹œê°„ ì½”ì¸ ì‹œì„¸</div>
          <span style="font-size:11px;color:var(--gn);font-weight:500">â— LIVE</span>
        </div>
        <div class="card-body" style="padding-top:10px">
          <table class="portfolio-table">
            <thead><tr><th>ì½”ì¸</th><th>í˜„ì¬ê°€ (KRW)</th><th>24h ë³€ë™</th></tr></thead>
            <tbody id="coin-body"><tr><td colspan="3" style="text-align:center;color:var(--g4);padding:20px">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr></tbody>
          </table>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ”„ ìµœê·¼ ê±°ë˜ ë‚´ì—­</div>
          <span style="color:var(--b6);font-size:13px;font-weight:500;cursor:pointer">ì „ì²´ë³´ê¸° â†’</span>
        </div>
        <div class="card-body" style="padding-top:8px">
          <div class="tx-item"><div class="tx-left"><div class="tx-icon buy">ğŸ“¥</div><div><div class="tx-name">Apple Inc. ë§¤ìˆ˜</div><div class="tx-date">2025.02.24 Â· AAPL</div></div></div><div><div class="tx-price text-down">-â‚©924,000</div><div class="tx-qty">4ì£¼ Ã— $231.50</div></div></div>
          <div class="tx-item"><div class="tx-left"><div class="tx-icon sell">ğŸ“¤</div><div><div class="tx-name">ì‚¼ì„±ì „ì ë§¤ë„</div><div class="tx-date">2025.02.22 Â· 005930</div></div></div><div><div class="tx-price text-up">+â‚©1,085,000</div><div class="tx-qty">15ì£¼ Ã— â‚©72,333</div></div></div>
          <div class="tx-item"><div class="tx-left"><div class="tx-icon deposit">ğŸ’µ</div><div><div class="tx-name">ì…ê¸ˆ</div><div class="tx-date">2025.02.20 Â· ê³„ì¢Œì´ì²´</div></div></div><div><div class="tx-price text-up">+â‚©5,000,000</div><div class="tx-qty">KRW</div></div></div>
          <div class="tx-item"><div class="tx-left"><div class="tx-icon buy">ğŸ“¥</div><div><div class="tx-name">ì´ë”ë¦¬ì›€ ë§¤ìˆ˜</div><div class="tx-date">2025.02.18 Â· ETH</div></div></div><div><div class="tx-price text-down">-â‚©2,572,800</div><div class="tx-qty">0.67 ETH</div></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì¢…ëª© ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-box">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">ì¢…ëª© ì¶”ê°€</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ìì‚° ìœ í˜•</label>
        <select class="form-select" id="f-type" onchange="onTypeChange()">
          <option value="kr">ğŸ‡°ğŸ‡· êµ­ë‚´ ì£¼ì‹</option>
          <option value="us">ğŸŒ í•´ì™¸ ì£¼ì‹ (USD)</option>
          <option value="crypto">ğŸª™ ì•”í˜¸í™”í</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ì¢…ëª©ëª…</label>
          <input class="form-input" id="f-name" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì"/>
        </div>
        <div class="form-group">
          <label class="form-label" id="ticker-label">í‹°ì»¤/ì¢…ëª©ì½”ë“œ</label>
          <input class="form-input" id="f-ticker" placeholder="ì˜ˆ: 005930" oninput="resetFetchStatus()"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ë³´ìœ  ìˆ˜ëŸ‰</label>
          <input class="form-input" id="f-qty" type="number" step="any" placeholder="0"/>
        </div>
        <div class="form-group">
          <label class="form-label" id="avgbuy-label">í‰ê·  ë§¤ìˆ˜ê°€ (â‚©)</label>
          <input class="form-input" id="f-avgbuy" type="number" step="any" placeholder="0"/>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" id="price-label">
          í˜„ì¬ê°€
          <span id="price-live-badge" style="display:none;font-size:10px;color:var(--gn);font-weight:500">â— ìë™ì—°ë™</span>
        </label>
        <div class="price-auto-row">
          <input class="form-input" id="f-price" type="number" step="any" placeholder="0"/>
          <button class="btn-fetch-price" id="btn-fetch" onclick="fetchPriceForModal()">
            <span>ğŸ”</span><span id="fetch-btn-txt">ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°</span>
          </button>
        </div>
        <div class="fetch-status" id="fetch-status" style="margin-top:6px"></div>
      </div>
      <div class="hint-box" id="modal-hint"></div>
      <div class="form-group" style="margin-top:16px;margin-bottom:0">
        <label class="form-label">ë°°ì§€ ìƒ‰ìƒ</label>
        <div class="color-swatches" id="color-swatches"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-danger" id="btn-modal-delete" style="display:none;margin-right:auto" onclick="deleteFromModal()">ğŸ—‘ ì‚­ì œ</button>
      <button class="btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="btn-primary" onclick="saveItem()">ğŸ’¾ ì €ì¥</button>
    </div>
  </div>
</div>

<!-- âœ… ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (ì™„ì „ ë…ë¦½, z-index:500) -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <div class="confirm-icon">ğŸ—‘ï¸</div>
    <div class="confirm-msg" id="confirm-msg">ì‚­ì œí• ê¹Œìš”?</div>
    <div class="confirm-sub">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
    <div class="confirm-btns">
      <button class="btn-secondary" onclick="closeConfirm()">ì·¨ì†Œ</button>
      <button class="btn-danger" onclick="execConfirm()">ì‚­ì œ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"><span id="toast-icon">âœ…</span><span id="toast-msg"></span></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ìƒìˆ˜ / ì´ˆê¸° ë°ì´í„°
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS=['#1d4ed8','#0ea5e9','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#f97316','#14b8a6','#1a1a1a','#627eea','#f7931a','#e91e63','#2196f3','#4caf50'];
const COIN_MAP={BTC:'bitcoin',ETH:'ethereum',SOL:'solana',XRP:'ripple',ADA:'cardano',DOGE:'dogecoin',MATIC:'matic-network',DOT:'polkadot',AVAX:'avalanche-2',BNB:'binancecoin',LINK:'chainlink',UNI:'uniswap'};

const DEFAULT_PORTFOLIO=[
  {id:'1',type:'kr',    name:'ì‚¼ì„±ì „ì',  ticker:'005930',qty:80,  avgBuy:66800,  currentPrice:72300, color:'#1d4ed8'},
  {id:'2',type:'kr',    name:'ì¹´ì¹´ì˜¤',    ticker:'035720',qty:120, avgBuy:48000,  currentPrice:46200, color:'#0ea5e9'},
  {id:'3',type:'us',    name:'Apple Inc.',ticker:'AAPL',  qty:15,  avgBuy:201.30, currentPrice:231.50,color:'#1a1a1a'},
  {id:'4',type:'us',    name:'Alphabet',  ticker:'GOOGL', qty:20,  avgBuy:183.60, currentPrice:196.80,color:'#4285f4'},
  {id:'5',type:'crypto',name:'ë¹„íŠ¸ì½”ì¸', ticker:'BTC',   qty:0.03,avgBuy:140200000,currentPrice:0,coinId:'bitcoin', color:'#f7931a'},
  {id:'6',type:'crypto',name:'ì´ë”ë¦¬ì›€', ticker:'ETH',   qty:0.67,avgBuy:3830000, currentPrice:0,coinId:'ethereum',color:'#627eea'},
];

// â”€â”€ Gist ì—°ë™ ì„¤ì • (í† í°ì€ ì½”ë“œì— ì €ì¥í•˜ì§€ ì•ŠìŒ) â”€â”€
const GIST_ID   = '4d3f0aea4fac4d1087053577e795ff0c';
const GIST_FILE = 'wealthboard1.json';

// í† í°ì€ URL íŒŒë¼ë¯¸í„°ì—ì„œ ì½ìŒ (?token=ghp_xxx)
// ì¡°íšŒìëŠ” í† í° ì—†ì´ ì ‘ì† â†’ ì½ê¸° ì „ìš© ìë™ ì ìš©
const URL_TOKEN = new URLSearchParams(window.location.search).get('token') || '';
function getToken(){ return URL_TOKEN; }
const IS_ADMIN = !!URL_TOKEN;

let portfolio = [];
let usdKrw = 1380;
let editingId = null;
let selColor = COLORS[0];
let pieInst = null;
let _confirmCb = null;
let isSaving = false;

// â”€â”€ Gist ì½ê¸° â”€â”€
async function loadFromGist(){
  setStatus('gist','loading','Gist ì—°ê²° ì¤‘...');
  if(!IS_ADMIN){
    // í† í° ì—†ìŒ â†’ ì½ê¸° ì „ìš© ëª¨ë“œ
    await loadGistReadOnly();
    return;
  }
  try{
    const r = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
      headers:{ 'Authorization': `token ${getToken()}` }
    });
    if(r.status===401){ setStatus('gist','error','í† í° ì˜¤ë¥˜'); showToast('âš ï¸','í† í°ì´ ì˜ëª»ëì–´ìš” â€” URLì˜ token= ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”'); return; }
    const d = await r.json();
    const content = d.files?.[GIST_FILE]?.content;
    if(content){
      portfolio = JSON.parse(content);
    } else {
      portfolio = DEFAULT_PORTFOLIO;
      await saveToGist();
    }
    setStatus('gist','ok','âœï¸ ê´€ë¦¬ì ëª¨ë“œ');
    const um = document.getElementById('user-mode');
    if(um) um.textContent = 'âœï¸ ê´€ë¦¬ì ëª¨ë“œ';
  }catch(e){
    setStatus('gist','error','Gist ì—°ê²° ì‹¤íŒ¨');
    portfolio = JSON.parse(localStorage.getItem('wb_v4')||'null') || DEFAULT_PORTFOLIO;
    showToast('âš ï¸','Gist ì—°ê²° ì‹¤íŒ¨ â€” ë¡œì»¬ ë°ì´í„° ì‚¬ìš© ì¤‘');
  }
}

// â”€â”€ Gist ì €ì¥ â”€â”€
async function saveToGist(){
  if(!IS_ADMIN){ showToast('âš ï¸','ì½ê¸° ì „ìš© ëª¨ë“œ â€” ìˆ˜ì •í•˜ë ¤ë©´ ê´€ë¦¬ì URLë¡œ ì ‘ì†í•˜ì„¸ìš”'); return; }
  if(isSaving) return;
  isSaving = true;
  setStatus('gist','loading','ì €ì¥ ì¤‘...');
  try{
    const r = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
      method: 'PATCH',
      headers:{
        'Authorization': `token ${getToken()}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        files:{ [GIST_FILE]:{ content: JSON.stringify(portfolio, null, 2) } }
      })
    });
    if(!r.ok) throw new Error('save failed');
    setStatus('gist','ok','âœï¸ ê´€ë¦¬ì ëª¨ë“œ');
    showToast('âœ…','ì €ì¥ë¨');
  }catch(e){
    setStatus('gist','error','ì €ì¥ ì‹¤íŒ¨');
    showToast('âš ï¸','ì €ì¥ ì‹¤íŒ¨ â€” ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
  } finally {
    isSaving = false;
  }
}

function saveLocal(){ saveToGist(); }

function setStatus(id, state, label){
  const dot = document.getElementById('dot-'+id);
  const lbl = document.getElementById('lbl-'+id);
  if(dot) dot.className = 'api-dot ' + state;
  if(lbl) lbl.textContent = label;
}

async function loadGistReadOnly(){
  setStatus('gist','loading','Gist ì½ëŠ” ì¤‘...');
  try{
    // í† í° ì—†ì´ raw URLë¡œ ì½ê¸°
    const r = await fetch(`https://gist.githubusercontent.com/neurostar01/${GIST_ID}/raw/${GIST_FILE}`);
    if(!r.ok) throw new Error('ì½ê¸° ì‹¤íŒ¨');
    portfolio = await r.json();
    setStatus('gist','ok','ğŸ‘ ì½ê¸° ì „ìš©');
    const um = document.getElementById('user-mode');
    if(um) um.textContent = 'ğŸ‘ ì½ê¸° ì „ìš©';
    // í¸ì§‘ UI ìˆ¨ê¸°ê¸°
    document.querySelectorAll('[onclick*="openModal"],[onclick*="fetchLive"]').forEach(el=>{
      if(el.tagName==='BUTTON' && el.textContent.includes('ì¶”ê°€')) el.style.display='none';
    });
    await fetchLive();
  }catch(e){
    setStatus('gist','error','ì½ê¸° ì‹¤íŒ¨');
    showToast('âš ï¸','Gist ì½ê¸° ì‹¤íŒ¨');
    portfolio = DEFAULT_PORTFOLIO;
    render();
  }
}



// ë‚ ì§œ
const td = new Date();
document.getElementById('current-date').textContent =
  `${td.getFullYear()}. ${String(td.getMonth()+1).padStart(2,'0')}. ${String(td.getDate()).padStart(2,'0')}`;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (ì™„ì „ ë…ë¦½)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showConfirm(msg, cb){
  _confirmCb = cb;
  document.getElementById('confirm-msg').textContent = msg;
  document.getElementById('confirm-overlay').classList.add('open');
}
function closeConfirm(){
  document.getElementById('confirm-overlay').classList.remove('open');
  _confirmCb = null;
}
function execConfirm(){
  const cb = _confirmCb;
  closeConfirm();
  if(cb) cb();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// API ìƒíƒœ ë„íŠ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setDot(id, s){ const e=document.getElementById(id); if(e) e.className='api-dot '+s; }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// í™˜ìœ¨
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchFX(){
  setDot('dot-fx','loading');
  try{
    const r = await fetch('https://open.er-api.com/v6/latest/USD');
    const d = await r.json();
    usdKrw = d.rates.KRW;
    setDot('dot-fx','ok');
  }catch{ setDot('dot-fx','error'); }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// í•´ì™¸ ì£¼ì‹ ì‹œì„¸ (stockprices.dev â€” no auth, CORS OK)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchUSPrice(ticker){
  try{
    const r = await fetch(`https://stockprices.dev/api/stocks/${ticker}`);
    if(!r.ok) throw new Error('not ok');
    const d = await r.json();
    return d.Price ?? null;
  }catch{ return null; }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// êµ­ë‚´ ì£¼ì‹ ì‹œì„¸ â€” ë³µìˆ˜ ì†ŒìŠ¤ ìˆœì°¨ ì‹œë„
// 1) Yahoo Finance (corsproxy.io)
// 2) Yahoo Finance (allorigins)
// 3) Yahoo Finance (ì§ì ‘)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchKRPrice(ticker){
  for(const suffix of ['.KS','.KQ']){
    const sym = ticker + suffix;
    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(sym)}?interval=1d&range=1d`;

    // ì‹œë„ 1: corsproxy.io
    try{
      const r = await fetch(`https://corsproxy.io/?${encodeURIComponent(yahooUrl)}`);
      if(r.ok){
        const d = await r.json();
        const price = d?.chart?.result?.[0]?.meta?.regularMarketPrice;
        if(price && price > 0) return price;
      }
    }catch{}

    // ì‹œë„ 2: allorigins
    try{
      const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`);
      if(r.ok){
        const outer = await r.json();
        const d = JSON.parse(outer.contents);
        const price = d?.chart?.result?.[0]?.meta?.regularMarketPrice;
        if(price && price > 0) return price;
      }
    }catch{}

    // ì‹œë„ 3: thingproxy
    try{
      const r = await fetch(`https://thingproxy.freeboard.io/fetch/${yahooUrl}`);
      if(r.ok){
        const d = await r.json();
        const price = d?.chart?.result?.[0]?.meta?.regularMarketPrice;
        if(price && price > 0) return price;
      }
    }catch{}
  }
  return null;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì½”ì¸ ì‹œì„¸ (CoinGecko)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchCrypto(){
  setDot('dot-crypto','loading');
  const cs = portfolio.filter(p=>p.type==='crypto'&&p.coinId);
  if(!cs.length){ setDot('dot-crypto','ok'); return; }
  try{
    const ids = [...new Set(cs.map(c=>c.coinId))].join(',');
    const r = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=krw&ids=${ids}&price_change_percentage=24h`);
    const data = await r.json();
    data.forEach(coin=>{
      portfolio.forEach(p=>{ if(p.coinId===coin.id){ p.currentPrice=coin.current_price; p.change24h=coin.price_change_percentage_24h; p.image=coin.image; } });
    });
    document.getElementById('coin-body').innerHTML = data.map(c=>{
      const ch=c.price_change_percentage_24h, isUp=ch>=0;
      return `<tr>
        <td><div style="display:flex;align-items:center;gap:8px">
          <img src="${c.image}" width="24" height="24" style="border-radius:50%" onerror="this.style.display='none'">
          <div><div style="font-size:13px;font-weight:600">${c.name}</div><div class="stock-ticker">${c.symbol.toUpperCase()}</div></div>
        </div></td>
        <td class="text-mono">â‚©${c.current_price.toLocaleString()}</td>
        <td><span class="tag ${isUp?'tag-up':'tag-down'}">${isUp?'â–²':'â–¼'} ${Math.abs(ch).toFixed(2)}%</span></td>
      </tr>`;
    }).join('');
    setDot('dot-crypto','ok');
  }catch{
    setDot('dot-crypto','error');
    document.getElementById('coin-body').innerHTML=`<tr><td colspan="3" style="text-align:center;color:var(--rd);padding:16px">âš ï¸ API ì—°ê²° ì‹¤íŒ¨</td></tr>`;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì „ì²´ ì£¼ì‹ ì‹œì„¸ ìë™ ì—…ë°ì´íŠ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchAllStockPrices(){
  const usStocks = portfolio.filter(p=>p.type==='us');
  const krStocks = portfolio.filter(p=>p.type==='kr');

  // í•´ì™¸ì£¼ì‹
  setDot('dot-us','loading');
  let usOk=0;
  await Promise.all(usStocks.map(async p=>{
    const price = await fetchUSPrice(p.ticker);
    if(price!==null){ p.currentPrice=price; usOk++; }
  }));
  setDot('dot-us', usOk>0||usStocks.length===0 ? 'ok' : 'error');

  // êµ­ë‚´ì£¼ì‹
  setDot('dot-kr','loading');
  let krOk=0;
  await Promise.all(krStocks.map(async p=>{
    const price = await fetchKRPrice(p.ticker);
    if(price!==null){ p.currentPrice=price; krOk++; }
  }));
  setDot('dot-kr', krOk>0||krStocks.length===0 ? 'ok' : 'error');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ëª¨ë‹¬ ì•ˆ "ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°" ë²„íŠ¼
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchPriceForModal(){
  const type   = document.getElementById('f-type').value;
  const ticker = document.getElementById('f-ticker').value.trim().toUpperCase();
  if(!ticker){ setFetchStatus('err','í‹°ì»¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const btn = document.getElementById('btn-fetch');
  btn.disabled = true;
  document.getElementById('fetch-btn-txt').textContent = 'ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
  setFetchStatus('','');

  try{
    let price = null;
    if(type==='us'){
      price = await fetchUSPrice(ticker);
    } else if(type==='kr'){
      price = await fetchKRPrice(ticker);
      if(price===null){
        // ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨ ì‹œ ë„¤ì´ë²„ ê¸ˆìœµ ë§í¬ ì•ˆë‚´
        setFetchStatus('err',`âš ï¸ ìë™ ì¡°íšŒ ì‹¤íŒ¨ â€” <a href="https://finance.naver.com/item/main.naver?code=${ticker}" target="_blank" style="color:var(--b5)">ë„¤ì´ë²„ ê¸ˆìœµì—ì„œ í™•ì¸ â†’</a>`);
        document.getElementById('fetch-status').innerHTML = document.getElementById('fetch-status').textContent;
        document.getElementById('fetch-status').innerHTML = `âš ï¸ ìë™ ì¡°íšŒ ì‹¤íŒ¨ â€” <a href="https://finance.naver.com/item/main.naver?code=${ticker}" target="_blank" style="color:var(--b5)">ë„¤ì´ë²„ ê¸ˆìœµì—ì„œ ì§ì ‘ í™•ì¸ í›„ ì…ë ¥ â†’</a>`;
        btn.disabled = false;
        document.getElementById('fetch-btn-txt').textContent = 'ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°';
        return;
      }
    } else if(type==='crypto'){
      const coinId = COIN_MAP[ticker] || ticker.toLowerCase();
      const r = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=krw`);
      const d = await r.json();
      price = d[coinId]?.krw ?? null;
    }

    if(price!==null && price>0){
      document.getElementById('f-price').value = price;
      setFetchStatus('ok', `âœ… ${price.toLocaleString()} ${type==='us'?'USD':'KRW'} â€” ì‹œì„¸ ë°˜ì˜ ì™„ë£Œ`);
    } else {
      setFetchStatus('err','âš ï¸ ì‹œì„¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í‹°ì»¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
    }
  }catch{
    setFetchStatus('err','âŒ ì—°ê²° ì˜¤ë¥˜. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
  }

  btn.disabled = false;
  document.getElementById('fetch-btn-txt').textContent = 'ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°';
}

function setFetchStatus(cls, msg){
  const el = document.getElementById('fetch-status');
  el.className = 'fetch-status' + (cls ? ' '+cls : '');
  el.textContent = msg;
}
function resetFetchStatus(){ setFetchStatus('',''); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë Œë”
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  const kr = portfolio.filter(p=>p.type==='kr');
  const us = portfolio.filter(p=>p.type==='us');
  const cr = portfolio.filter(p=>p.type==='crypto');
  const krT = kr.reduce((s,p)=>s+p.qty*p.currentPrice,0);
  const usT = us.reduce((s,p)=>s+p.qty*p.currentPrice*usdKrw,0);
  const crT = cr.reduce((s,p)=>s+p.qty*p.currentPrice,0);
  const tot = krT+usT+crT;

  setTxt('s-total',`â‚©${Math.round(tot).toLocaleString()}`);
  setTxt('s-kr',`â‚©${Math.round(krT).toLocaleString()}`);
  setTxt('s-us',`â‚©${Math.round(usT).toLocaleString()}`);
  setTxt('s-crypto',`â‚©${Math.round(crT).toLocaleString()}`);

  const krC=kr.reduce((s,p)=>s+p.qty*p.avgBuy,0);
  const usC=us.reduce((s,p)=>s+p.qty*p.avgBuy*usdKrw,0);
  const crC=cr.reduce((s,p)=>s+p.qty*p.avgBuy,0);
  const totC=krC+usC+crC;
  setChg('s-total-c',tot-totC,totC);
  setChg('s-kr-c',krT-krC,krC);
  setChg('s-us-c',usT-usC,usC);
  setChg('s-crypto-c',crT-crC,crC);

  const pKr=tot?(krT/tot*100).toFixed(1):0;
  const pUs=tot?(usT/tot*100).toFixed(1):0;
  const pCr=tot?(crT/tot*100).toFixed(1):0;
  setTxt('pct-kr',pKr+'%'); setTxt('pct-us',pUs+'%'); setTxt('pct-crypto',pCr+'%');
  if(pieInst){ pieInst.data.datasets[0].data=[+pKr,+pUs,+pCr]; pieInst.update(); }

  setTxt('portfolio-count',`${portfolio.length}ì¢…ëª©`);

  if(!portfolio.length){
    document.getElementById('portfolio-body').innerHTML=`<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">ğŸ“­</div><div class="empty-title">ì•„ì§ ì¢…ëª©ì´ ì—†ì–´ìš”</div><div class="empty-sub">+ ì¢…ëª© ì¶”ê°€ ë²„íŠ¼ìœ¼ë¡œ ì²« ì¢…ëª©ì„ ë“±ë¡í•´ë³´ì„¸ìš”</div></div></td></tr>`;
    return;
  }

  document.getElementById('portfolio-body').innerHTML = portfolio.map(p=>{
    const evalKrw = p.type==='us' ? p.qty*p.currentPrice*usdKrw : p.qty*p.currentPrice;
    const costKrw = p.type==='us' ? p.qty*p.avgBuy*usdKrw : p.qty*p.avgBuy;
    const pct = costKrw ? (evalKrw-costKrw)/costKrw*100 : 0;
    const prStr = p.type==='us' ? `$${p.currentPrice.toLocaleString()}` : `â‚©${Math.round(p.currentPrice).toLocaleString()}`;
    const avStr = p.type==='us' ? `$${p.avgBuy.toLocaleString()}` : `â‚©${p.avgBuy.toLocaleString()}`;
    const qStr  = p.type==='crypto' ? `${p.qty} ${p.ticker}` : `${p.qty}ì£¼`;
    const badge = p.type==='kr'?'badge-kr':p.type==='us'?'badge-us':'badge-crypto';
    const bTxt  = p.type==='kr'?'êµ­ë‚´':p.type==='us'?'í•´ì™¸':'ì½”ì¸';
    const liveBadge = (p.type==='crypto'||p.type==='us'||p.type==='kr') && p.currentPrice>0
      ? `<span class="price-live">â— LIVE</span>` : '';
    return `<tr>
      <td><div class="stock-info">
        <div class="stock-badge" style="background:${p.color}">${p.name[0]}</div>
        <div><div class="stock-name">${p.name}</div><div class="stock-ticker">${p.ticker}${liveBadge}</div></div>
      </div></td>
      <td><span class="badge-type ${badge}">${bTxt}</span></td>
      <td class="text-mono">${prStr}</td>
      <td class="text-mono">${qStr}</td>
      <td class="text-mono">${avStr}</td>
      <td class="text-mono">â‚©${Math.round(evalKrw).toLocaleString()}</td>
      <td class="${pct>=0?'text-up':'text-down'}">${pct>=0?'â–²':'â–¼'} ${Math.abs(pct).toFixed(2)}%</td>
      <td><div class="row-actions">
        <button class="btn-row btn-edit" data-action="edit" data-id="${p.id}">ìˆ˜ì •</button>
        <button class="btn-row btn-del"  data-action="del"  data-id="${p.id}">ì‚­ì œ</button>
      </div></td>
    </tr>`;
  }).join('');
}

// ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ìˆ˜ì •/ì‚­ì œ
document.getElementById('portfolio-body').addEventListener('click', e=>{
  const btn = e.target.closest('[data-action]');
  if(!btn) return;
  e.stopPropagation();
  const id = btn.dataset.id;
  if(btn.dataset.action==='edit') openModal(id);
  else if(btn.dataset.action==='del') delItem(id);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id=null){
  editingId = id;
  const item = id ? portfolio.find(p=>p.id===id) : null;
  document.getElementById('modal-title').textContent = id ? 'ì¢…ëª© ìˆ˜ì •' : 'ì¢…ëª© ì¶”ê°€';
  document.getElementById('btn-modal-delete').style.display = id ? 'block' : 'none';
  setFetchStatus('','');

  if(item){
    document.getElementById('f-type').value    = item.type;
    document.getElementById('f-name').value    = item.name;
    document.getElementById('f-ticker').value  = item.ticker;
    document.getElementById('f-qty').value     = item.qty;
    document.getElementById('f-avgbuy').value  = item.avgBuy;
    document.getElementById('f-price').value   = item.currentPrice || '';
    selColor = item.color;
  } else {
    document.getElementById('f-type').value = 'kr';
    ['f-name','f-ticker','f-qty','f-avgbuy','f-price'].forEach(fid=>document.getElementById(fid).value='');
    selColor = COLORS[0];
  }
  onTypeChange();
  renderSwatches();
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(){
  document.getElementById('modal-overlay').classList.remove('open');
  editingId = null;
}

// ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸° (ëª¨ë‹¬ ë°•ìŠ¤ í´ë¦­ì€ ë¬´ì‹œ)
document.getElementById('modal-overlay').addEventListener('click', e=>{
  if(e.target === document.getElementById('modal-overlay')) closeModal();
});

function onTypeChange(){
  const t = document.getElementById('f-type').value;
  const hint = document.getElementById('modal-hint');
  const badge = document.getElementById('price-live-badge');
  if(t==='crypto'){
    document.getElementById('ticker-label').textContent = 'ì½”ì¸ ì‹¬ë³¼ (BTC, ETH, SOLâ€¦)';
    document.getElementById('avgbuy-label').textContent = 'í‰ê·  ë§¤ìˆ˜ê°€ (â‚©)';
    document.getElementById('price-label').childNodes[0].textContent = 'í˜„ì¬ê°€ (KRW) ';
    badge.style.display='inline';
    hint.innerHTML='ğŸ’¡ ì½”ì¸ ì‹¬ë³¼ ì…ë ¥ í›„ <strong>"ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°"</strong>ë¥¼ ëˆ„ë¥´ë©´ CoinGeckoì—ì„œ ìë™ìœ¼ë¡œ í˜„ì¬ê°€ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.';
  } else if(t==='us'){
    document.getElementById('ticker-label').textContent = 'í‹°ì»¤ ì‹¬ë³¼ (AAPL, TSLA, NVDAâ€¦)';
    document.getElementById('avgbuy-label').textContent = 'í‰ê·  ë§¤ìˆ˜ê°€ ($USD)';
    document.getElementById('price-label').childNodes[0].textContent = 'í˜„ì¬ê°€ (USD) ';
    badge.style.display='inline';
    hint.innerHTML='ğŸ’¡ í‹°ì»¤ ì…ë ¥ í›„ <strong>"ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°"</strong>ë¥¼ ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ ë¯¸êµ­ ì£¼ê°€ë¥¼ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.';
  } else {
    document.getElementById('ticker-label').textContent = 'ì¢…ëª©ì½”ë“œ (005930, 035720â€¦)';
    document.getElementById('avgbuy-label').textContent = 'í‰ê·  ë§¤ìˆ˜ê°€ (â‚©)';
    document.getElementById('price-label').childNodes[0].textContent = 'í˜„ì¬ê°€ (KRW) ';
    badge.style.display='inline';
    hint.innerHTML='ğŸ’¡ ì¢…ëª©ì½”ë“œ ì…ë ¥ í›„ <strong>"ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°"</strong>ë¥¼ ëˆ„ë¥´ë©´ Yahoo Financeì—ì„œ í˜„ì¬ êµ­ë‚´ ì£¼ê°€ë¥¼ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.';
  }
  resetFetchStatus();
}

function renderSwatches(){
  document.getElementById('color-swatches').innerHTML = COLORS.map(c=>
    `<div class="swatch${c===selColor?' selected':''}" style="background:${c}" onclick="pickColor('${c}')"></div>`
  ).join('');
}
function pickColor(c){ selColor=c; renderSwatches(); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì €ì¥
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveItem(){
  const type   = document.getElementById('f-type').value;
  const name   = document.getElementById('f-name').value.trim();
  const ticker = document.getElementById('f-ticker').value.trim().toUpperCase();
  const qty    = parseFloat(document.getElementById('f-qty').value)||0;
  const avgBuy = parseFloat(document.getElementById('f-avgbuy').value)||0;
  const price  = parseFloat(document.getElementById('f-price').value)||0;
  if(!name||!ticker||!qty||!avgBuy){ showToast('âš ï¸','ì¢…ëª©ëª…, í‹°ì»¤, ìˆ˜ëŸ‰, ë§¤ìˆ˜ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  const item = {
    id: editingId || String(Date.now()),
    type, name, ticker, qty, avgBuy, currentPrice:price, color:selColor,
    ...(type==='crypto' && {coinId: COIN_MAP[ticker] || ticker.toLowerCase()})
  };
  if(editingId){
    const i = portfolio.findIndex(p=>p.id===editingId);
    if(i!==-1) portfolio[i] = item;
    showToast('âœ…',`${name} ìˆ˜ì • ì™„ë£Œ`);
  } else {
    portfolio.push(item);
    showToast('âœ…',`${name} ì¶”ê°€ ì™„ë£Œ`);
  }
  saveLocal();
  closeModal();
  fetchLive();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì‚­ì œ â€” showConfirm ì‚¬ìš© (confirm() ì™„ì „ ì œê±°)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function delItem(id){
  const item = portfolio.find(p=>p.id===id);
  if(!item) return;
  showConfirm(`"${item.name}"ì„(ë¥¼) ì‚­ì œí• ê¹Œìš”?`, ()=>{
    portfolio = portfolio.filter(p=>p.id!==id);
    saveLocal();
    render();
    showToast('ğŸ—‘ï¸',`${item.name} ì‚­ì œë¨`);
  });
}

function deleteFromModal(){
  if(!editingId) return;
  const item = portfolio.find(p=>p.id===editingId);
  if(!item) return;
  showConfirm(`"${item.name}"ì„(ë¥¼) ì‚­ì œí• ê¹Œìš”?`, ()=>{
    portfolio = portfolio.filter(p=>p.id!==editingId);
    saveLocal();
    closeModal();
    render();
    showToast('ğŸ—‘ï¸',`${item.name} ì‚­ì œë¨`);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ìœ í‹¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setTxt(id,v){ const e=document.getElementById(id); if(e) e.textContent=v; }
function setChg(id,diff,cost){
  const e=document.getElementById(id); if(!e||!cost) return;
  const pct=(diff/cost*100).toFixed(2), isUp=diff>=0;
  e.className=`card-change ${isUp?'up':'down'}`;
  e.textContent=`${isUp?'â–²':'â–¼'} ${isUp?'+':''}${Math.round(diff).toLocaleString()} (${isUp?'+':''}${pct}%)`;
}
function showToast(icon,msg){
  document.getElementById('toast-icon').textContent=icon;
  document.getElementById('toast-msg').textContent=msg;
  const t=document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2800);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì°¨íŠ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const rCtx = document.getElementById('returnChart').getContext('2d');
const grad = rCtx.createLinearGradient(0,0,0,220);
grad.addColorStop(0,'rgba(59,130,246,.18)'); grad.addColorStop(1,'rgba(59,130,246,0)');
const CD={
  '1W':{labels:['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'],data:[55800000,56200000,55900000,57100000,57800000,58100000,58420000]},
  '1M':{labels:['1','3','5','7','9','11','13','15','17','19','21','23','24'],data:[53200000,54000000,53500000,55200000,54800000,56000000,55700000,57100000,56900000,57800000,58100000,57900000,58420000]},
  '3M':{labels:['11ì›”','12ì›”','1ì›”','2ì›”'],data:[49000000,51500000,55000000,58420000]},
  '1Y':{labels:['3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”','1ì›”','2ì›”'],data:[38000000,40500000,41200000,43000000,42500000,44800000,46200000,47900000,49000000,51500000,55000000,58420000]}
};
let rChart = new Chart(rCtx,{type:'line',data:{labels:CD['1M'].labels,datasets:[{data:CD['1M'].data,borderColor:'#3b82f6',backgroundColor:grad,borderWidth:2.5,pointRadius:0,pointHoverRadius:5,fill:true,tension:0.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`â‚©${ctx.raw.toLocaleString()}`},backgroundColor:'#1e293b',titleColor:'#94a3b8',bodyColor:'#fff',padding:10,borderRadius:8}},scales:{x:{grid:{display:false},ticks:{color:'#94a3b8',font:{size:11}},border:{display:false}},y:{grid:{color:'#f1f5f9'},ticks:{color:'#94a3b8',font:{size:11},callback:v=>`â‚©${(v/10000000).toFixed(1)}ì²œë§Œ`},border:{display:false}}}}});

function switchTab(el,p){
  document.querySelectorAll('.chart-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  rChart.data.labels=CD[p].labels; rChart.data.datasets[0].data=CD[p].data; rChart.update();
}

const pCtx = document.getElementById('pieChart').getContext('2d');
pieInst = new Chart(pCtx,{type:'doughnut',data:{labels:['êµ­ë‚´','í•´ì™¸','ì½”ì¸'],datasets:[{data:[37.9,51.1,11.0],backgroundColor:['#3b82f6','#f59e0b','#8b5cf6'],borderWidth:0,hoverOffset:6}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${ctx.raw}%`},backgroundColor:'#1e293b',bodyColor:'#fff',padding:10,borderRadius:8}}}});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì „ì²´ ìƒˆë¡œê³ ì¹¨
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchLive(){
  document.getElementById('api-updated').textContent = 'ì—…ë°ì´íŠ¸ ì¤‘...';
  await Promise.all([fetchFX(), fetchCrypto(), fetchAllStockPrices()]);
  saveLocal();
  render();
  const n=new Date();
  document.getElementById('api-updated').textContent =
    `ì—…ë°ì´íŠ¸: ${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
}

// ì´ˆê¸° ë¡œë“œ â€” Gistì—ì„œ ë°ì´í„° ë¨¼ì € ë¶ˆëŸ¬ì˜¨ í›„ ì‹œì„¸ ì—…ë°ì´íŠ¸
(async ()=>{
  await loadFromGist();
  await fetchLive();
  setInterval(fetchLive, 60000);
})();
</script>
</body>
</html>
